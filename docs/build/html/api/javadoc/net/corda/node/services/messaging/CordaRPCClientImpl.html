<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_121) on Thu Mar 02 15:43:10 GMT 2017 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>CordaRPCClientImpl</title>
<meta name="date" content="2017-03-02">
<meta name="keywords" content="net.corda.node.services.messaging.CordaRPCClientImpl class">
<meta name="keywords" content="Companion">
<meta name="keywords" content="proxyFor()">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="CordaRPCClientImpl";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../net/corda/node/services/messaging/CordaRPCClient.html" title="class in net.corda.node.services.messaging"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../net/corda/node/services/messaging/RPCException.DeadlineExceeded.html" title="class in net.corda.node.services.messaging"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?net/corda/node/services/messaging/CordaRPCClientImpl.html" target="_top">Frames</a></li>
<li><a href="CordaRPCClientImpl.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">net.corda.node.services.messaging</div>
<h2 title="Class CordaRPCClientImpl" class="title">Class CordaRPCClientImpl</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>net.corda.node.services.messaging.CordaRPCClientImpl</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">CordaRPCClientImpl</span></pre>
<div class="block"><p><p>Core RPC engine implementation, to learn how to use RPC you should be looking at <a href="../../../../../net/corda/node/services/messaging/CordaRPCClient.html" title="class in net.corda.node.services.messaging"><code>class CordaRPCClient</code></a>.</p></p><p><p><h1>Design notes</h1><p>The way RPCs are handled is fairly standard except for the handling of observables. When an RPC might return
an Observable it is specially tagged. This causes the client to create a new transient queue for the
receiving of observables and their observations with a random ID in the name. This ID is sent to the server in
a message header. All observations are sent via this single queue.</p><p>The reason for doing it this way and not the more obvious approach of one-queue-per-observable is that we want
the queues to be <em>transient</em>, meaning their lifetime in the broker is tied to the session that created them.
A server side observable and its associated queue is not a cost-free thing, let alone the memory and resources
needed to actually generate the observations themselves, therefore we want to ensure these cannot leak. A
transient queue will be deleted automatically if the client session terminates, which by default happens on
disconnect but can also be configured to happen after a short delay (this allows clients to e.g. switch IP
address). On the server the deletion of the observations queue triggers unsubscription from the associated
observables, which in turn may then be garbage collected.</p><p>Creating a transient queue requires a roundtrip to the broker and thus doing an RPC that could return
observables takes two server roundtrips instead of one. That's why we require RPCs to be marked with
<a href="../../../../../net/corda/core/messaging/RPCReturnsObservables.html" title="interface in net.corda.core.messaging"><code>interface RPCReturnsObservables</code></a> as needing this special treatment instead of always doing it.</p><p>If the Artemis/JMS APIs allowed us to create transient queues assigned to someone else then we could
potentially use a different design in which the node creates new transient queues (one per observable) on the
fly. The client would then have to watch out for this and start consuming those queues as they were created.</p><p>We use one queue per RPC because we don't know ahead of time how many observables the server might return and
often the server doesn't know either, which pushes towards a single queue design, but at the same time the
processing of observations returned by an RPC might be striped across multiple threads and we'd like
backpressure management to not be scoped per client process but with more granularity. So we end up with
a compromise where the unit of backpressure management is the response to a single RPC.</p><p>TODO: Backpressure isn't propagated all the way through the MQ broker at the moment.</p></p></p></div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../net/corda/node/services/messaging/CordaRPCClient.html" title="class in net.corda.node.services.messaging"><code>class CordaRPCClient</code></a>, 
<a href="../../../../../net/corda/core/messaging/RPCReturnsObservables.html" title="interface in net.corda.core.messaging"><code>interface RPCReturnsObservables</code></a></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested.class.summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Nested Class Summary table, listing nested classes, and an explanation">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Class and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../net/corda/node/services/messaging/CordaRPCClientImpl.Companion.html" title="class in net.corda.node.services.messaging">CordaRPCClientImpl.Companion</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static <a href="../../../../../net/corda/node/services/messaging/CordaRPCClientImpl.Companion.html" title="type parameter in CordaRPCClientImpl.Companion">CordaRPCClientImpl.Companion</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../net/corda/node/services/messaging/CordaRPCClientImpl.html#Companion">Companion</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../net/corda/node/services/messaging/CordaRPCClientImpl.html#CordaRPCClientImpl-session-sessionLock-username-">CordaRPCClientImpl</a></span>(org.apache.activemq.artemis.api.core.client.ClientSession&nbsp;session,
                  java.util.concurrent.locks.ReentrantLock&nbsp;sessionLock,
                  java.lang.String&nbsp;username)</code>
<div class="block">Core RPC engine implementation, to learn how to use RPC you should be looking at <a href="../../../../../net/corda/node/services/messaging/CordaRPCClient.html" title="class in net.corda.node.services.messaging"><code>class CordaRPCClient</code></a>.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>&lt;T extends <a href="../../../../../net/corda/core/messaging/RPCOps.html" title="type parameter in RPCOps">RPCOps</a>&gt;<br>T</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../net/corda/node/services/messaging/CordaRPCClientImpl.html#proxyFor-rpcInterface-timeout-minVersion-">proxyFor</a></span>(java.lang.Class&lt;T&gt;&nbsp;rpcInterface,
        java.time.Duration&nbsp;timeout,
        int&nbsp;minVersion)</code>
<div class="block">Builds a proxy for the given type, which must descend from <a href="../../../../../net/corda/core/messaging/RPCOps.html" title="interface in net.corda.core.messaging"><code>interface RPCOps</code></a>.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="Companion">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>Companion</h4>
<pre>public static&nbsp;<a href="../../../../../net/corda/node/services/messaging/CordaRPCClientImpl.Companion.html" title="type parameter in CordaRPCClientImpl.Companion">CordaRPCClientImpl.Companion</a> Companion</pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="CordaRPCClientImpl-session-sessionLock-username-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>CordaRPCClientImpl</h4>
<pre>public&nbsp;CordaRPCClientImpl(org.apache.activemq.artemis.api.core.client.ClientSession&nbsp;session,
                          java.util.concurrent.locks.ReentrantLock&nbsp;sessionLock,
                          java.lang.String&nbsp;username)</pre>
<div class="block"><p><p>Core RPC engine implementation, to learn how to use RPC you should be looking at <a href="../../../../../net/corda/node/services/messaging/CordaRPCClient.html" title="class in net.corda.node.services.messaging"><code>class CordaRPCClient</code></a>.</p></p><p><p><h1>Design notes</h1><p>The way RPCs are handled is fairly standard except for the handling of observables. When an RPC might return
an Observable it is specially tagged. This causes the client to create a new transient queue for the
receiving of observables and their observations with a random ID in the name. This ID is sent to the server in
a message header. All observations are sent via this single queue.</p><p>The reason for doing it this way and not the more obvious approach of one-queue-per-observable is that we want
the queues to be <em>transient</em>, meaning their lifetime in the broker is tied to the session that created them.
A server side observable and its associated queue is not a cost-free thing, let alone the memory and resources
needed to actually generate the observations themselves, therefore we want to ensure these cannot leak. A
transient queue will be deleted automatically if the client session terminates, which by default happens on
disconnect but can also be configured to happen after a short delay (this allows clients to e.g. switch IP
address). On the server the deletion of the observations queue triggers unsubscription from the associated
observables, which in turn may then be garbage collected.</p><p>Creating a transient queue requires a roundtrip to the broker and thus doing an RPC that could return
observables takes two server roundtrips instead of one. That's why we require RPCs to be marked with
<a href="../../../../../net/corda/core/messaging/RPCReturnsObservables.html" title="interface in net.corda.core.messaging"><code>interface RPCReturnsObservables</code></a> as needing this special treatment instead of always doing it.</p><p>If the Artemis/JMS APIs allowed us to create transient queues assigned to someone else then we could
potentially use a different design in which the node creates new transient queues (one per observable) on the
fly. The client would then have to watch out for this and start consuming those queues as they were created.</p><p>We use one queue per RPC because we don't know ahead of time how many observables the server might return and
often the server doesn't know either, which pushes towards a single queue design, but at the same time the
processing of observations returned by an RPC might be striped across multiple threads and we'd like
backpressure management to not be scoped per client process but with more granularity. So we end up with
a compromise where the unit of backpressure management is the response to a single RPC.</p><p>TODO: Backpressure isn't propagated all the way through the MQ broker at the moment.</p></p></p></div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../net/corda/node/services/messaging/CordaRPCClient.html" title="class in net.corda.node.services.messaging"><code>class CordaRPCClient</code></a>, 
<a href="../../../../../net/corda/core/messaging/RPCReturnsObservables.html" title="interface in net.corda.core.messaging"><code>interface RPCReturnsObservables</code></a></dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="proxyFor-rpcInterface-timeout-minVersion-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>proxyFor</h4>
<pre>public&nbsp;&lt;T extends <a href="../../../../../net/corda/core/messaging/RPCOps.html" title="type parameter in RPCOps">RPCOps</a>&gt;&nbsp;T&nbsp;proxyFor(java.lang.Class&lt;T&gt;&nbsp;rpcInterface,
                                     java.time.Duration&nbsp;timeout,
                                     int&nbsp;minVersion)</pre>
<div class="block"><p><p>Builds a proxy for the given type, which must descend from <a href="../../../../../net/corda/core/messaging/RPCOps.html" title="interface in net.corda.core.messaging"><code>interface RPCOps</code></a>.</p></p></div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../net/corda/core/messaging/RPCOps.html" title="interface in net.corda.core.messaging"><code>interface RPCOps</code></a></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../net/corda/node/services/messaging/CordaRPCClient.html" title="class in net.corda.node.services.messaging"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../net/corda/node/services/messaging/RPCException.DeadlineExceeded.html" title="class in net.corda.node.services.messaging"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?net/corda/node/services/messaging/CordaRPCClientImpl.html" target="_top">Frames</a></li>
<li><a href="CordaRPCClientImpl.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
